# Helix Command Line Interface (`hlx`)

## Status
[![codecov](https://img.shields.io/codecov/c/github/adobe/helix-cli.svg)](https://codecov.io/gh/adobe/helix-cli)
[![CircleCI](https://img.shields.io/circleci/project/github/adobe/helix-cli.svg)](https://circleci.com/gh/adobe/helix-cli)
[![GitHub license](https://img.shields.io/github/license/adobe/helix-cli.svg)](https://github.com/adobe/helix-cli/blob/master/LICENSE.txt)
[![GitHub issues](https://img.shields.io/github/issues/adobe/helix-cli.svg)](https://github.com/adobe/helix-cli/issues)
[![Greenkeeper badge](https://badges.greenkeeper.io/adobe/helix-cli.svg)](https://greenkeeper.io/)
[![LGTM Code Quality Grade: JavaScript](https://img.shields.io/lgtm/grade/javascript/g/adobe/helix-cli.svg?logo=lgtm&logoWidth=18)](https://lgtm.com/projects/g/adobe/helix-cli)

The Helix Command Line Interface allows web developers to create, develop, and deploy digital experiences using Project Helix

## Installation

Install `hlx` as a global command. You need Node 8 or newer.

```bash
$ npm install -g @adobe/helix-cli
```

## Quick Start

```bash
$ hlx --help
hlx <command>

Commands:
  hlx demo <name> [dir]  Create example helix project.
  hlx up [files...]      Run a Helix development server
  hlx build [files..]    Compile the template functions and build package
  hlx deploy             Deploy packaged functions to Adobe I/O runtime
  hlx perf               Test performance
  hlx strain             Activate strains in the Fastly CDN

Options:
  --version  Show version number                                       [boolean]
  --help     Show help                                                 [boolean]

for more information, find our manual at https://github.com/adobe/helix-cli
```

## Setting up a project

```bash
$ hlx demo <my-cool-project>
```

## Starting development

```bash
$ cd <my-cool-project>
$ hlx up
```

Just change contents in your project directory and reload `http://localhost:3000` to see the results.

## (Optional) Build artifacts

```bash
# In <my-cool-project>
$ hlx build
```

## (Optional) Test functions

```bash
# In <my-cool-project>
$ hlx test
```

## (Optional) Deploy to Adobe I/O Runtime

```bash
# In <my-cool-project>
$ hlx deploy --no-auto --wsk-namespace <your-namespace> --wsk-auth <your-key>
```

Instead of passing `--wsk-auth` as a command line option, you can also set the `HLX_WSK_AUTH` environment variable.

## (Optional) Publish your Site

```bash
# In <my-cool-project>
$ hlx strain --fastly-auth <key> --fastly-namespace <serviceid>
ğŸ‘ ğŸ‘¾ ğŸš€  hlx is publishing strains
ğŸ‘  Cloned latest version, version 356 is ready
ğŸ—  Enabled Fastly to call secure OpenWhisk actions
ğŸŒ²  Set content root for strain preview
ğŸ‘¾  Set action root for strain  preview
ğŸ‘¾  Set action root for strain  xdm
ğŸ¢  Set owner for strain        xdm
ğŸŒ³  Set repo for strain         default
ğŸŒ³  Set repo for strain         soupdemo
ğŸŒ³  Set repo for strain         xdm
ğŸ·  Set ref for strain          default
ğŸ¢  Set owner for strain        preview
ğŸ‘¾  Set action root for strain  db5d4350c13924ad
ğŸ·  Set ref for strain          db5d4350c13924ad
ğŸ‘¾  Set action root for strain  soupdemo
ğŸ‘¾  Set action root for strain  default
ğŸ¢  Set owner for strain        soupdemo
ğŸ·  Set ref for strain          soupdemo
ğŸ¢  Set owner for strain        default
ğŸ·  Set ref for strain          preview
ğŸ¢  Set owner for strain        db5d4350c13924ad
ğŸ·  Set ref for strain          xdm
ğŸŒ³  Set repo for strain         preview
ğŸŒ³  Set repo for strain         db5d4350c13924ad
ğŸŒ²  Set content root for strain default
âœ…  VCL strains.vcl has been updated
ğŸŒ²  Set content root for strain soupdemo
ğŸŒ²  Set content root for strain xdm
ğŸŒ²  Set content root for strain db5d4350c13924ad
ğŸ“•  All dicts have been updated.
ğŸš€  Activated latest version, version 356 is live
ğŸ’€  Purged entire cache
```

### Directory Index

The default behavior for directory indexes is to load `index.html` when requesting a path ending with `/`,
so that `/foo/bar/` becomes `/foo/bar/index.html`. This setting can be overwritten in `.hlx/strains.yaml`
by adding an `index` property:

```yaml
- strain:
    name: default
    code: /hlx/default/git-github-com-adobe-helix-cli-git--dirty--
    index: README.html
    content:
      repo: helix-cli
      ref: master
      owner: adobe
```

### Static Content Handling

During `hlx build`, the static files are copied into `.hlx/dist`. The static files originate either
from a `src/**/static` directory, or are generated by the packager. The exact details are not defined
yet and might change in future versions. Example of static files are stylesheets, clientside javascripts,
 icons, web fonts, etc. 

Static content is served from the code repository of the Helix project. By default, whatever remote `origin` repository is set at the time of running `hlx strain` is used, but this can be overridden in the configuration file:

```yaml
- strain:
    name: default
    static:
      repo: reactor-user-docs
      ref: master
      owner: Adobe-Marketing-Cloud
```

The same core configuration options (`repo`, `ref`, and `owner`) are supported for `static` as for `content`. 

#### Securing Static Content

Because the code repository may contain sensitive information, static content is protected using a hard-coded blacklist. This blacklist includes `package.json`, `src`, and every hidden file or directory (starting with `.`).

In `strains.yaml`, additional white- and blacklists may be specified using the `allow` and `deny` properties underneath `static`. Each `allow` or `deny` is a list of glob expressions such as `"*.js"`. YAML requires you to put quotes around the glob expression.

Examples of a whitelist and blacklist configuration may look like this:

```yaml
- strain:
    name: default
    static:
      repo: reactor-user-docs
      ref: master
      owner: Adobe-Marketing-Cloud
      allow:
        - "/dist/*"
        - "/static/*"
      deny:
        - "*.htl"
```

If a blacklist is specified, every path matching any of the patterns in the blacklist will be rejected. If a whitelist is specified, only paths matching patterns on the whitelist will be accepted.

A blacklist can block items that have been allowed by the whitelist, but not vice versa.

## Matching Strains to URLs

You can define a `url` for each `strain`. This property will make sure that only requests made
to this base URL will be mapped to the following URL, enabling patterns like having a production
instance on `www.*` and a development instance on `dev.*`.

An example configuration could look like this:

```yaml
- strain:
    name: default
    code: /trieloff/default/https---github-com-adobe-helix-helpx-git--master--
    url: https://www.primordialsoup.life
    content:
      repo: reactor-user-docs
      ref: master
      owner: Adobe-Marketing-Cloud
      root: /
- strain:
    name: cd629c5a74d6d60f
    url: https://dev.primordialsoup.life/develop/
    code: /trieloff/default/https---github-com-adobe-helix-helpx-git--develop--
    content:
      repo: reactor-user-docs
      ref: master
      owner: Adobe-Marketing-Cloud
```
